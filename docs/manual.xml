<?xml version="1.0" encoding="UTF-8"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://docbook.org/ns/docbook              http://docbook.org/xml/5.0/xsd/docbook.xsd" version="5.0" xml:id="index">
  <info>
    <title>Home</title>
  </info>
  <section xml:id="overview">
    <title>Atomia DNS Overview</title>
    <section xml:id="overview-whatis">
      <title>What is Atomia DNS</title>
      <para>Atomia DNS is a system to provision and improve administration of DNS settings across several DNS-servers. DNS-servers can be geographically spread and are optimized to handle large amounts of DNS-data by using a local database instead of zone files.</para>
      <para>The local databases of individual DNS-servers are updated from a main database which contains data for all servers.</para>
      <para>Atomia DNS provides a API which lets applications update DNS-data in a very simple way.</para>
    </section>
    <section xml:id="overview-system">
      <title>System overview</title>
      <para>Atomia DNS is a DNS system which enables easy management of DNS zones through a programmatic SOAP interface. The system consists of several parts which are described below.</para>
      <para>
        <informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/Atomia_DNS_overview_v3.png" width="100%" />
            </imageobject>
          </mediaobject>
        </informalfigure>
      </para>
      <orderedlist>
        <listitem>
          <para>
            <emphasis role="strong">Clients</emphasis>
          </para>
          <orderedlist>
            <listitem>
              <para>
                <emphasis role="strong">DynDNS:</emphasis>
                RFC2136 Dynamic DNS update daemon proxying updates to the API.
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="strong">Web user interface:</emphasis>
                Web interface to make changes using the API.
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="strong">Command line interface:</emphasis>
                CLI tool to make changes using the API.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">Atomia DNS API:</emphasis>
            Part of Atomia DNS Master server
          </para>
          <orderedlist>
            <listitem>
              <para>
                <emphasis role="strong">Atomia DNS API:</emphasis>
                The API is used by clients to make changes in the DNS settings as well as for communicating with different DNS servers. The two logical APIs (SyncSOAP and DNS SOAP API) are both provided by the same SOAP Server, installed using the atomiadns-api package.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">Atomia DNS database:</emphasis>
            Part of Atomia DNS Master server.
          </para>
          <orderedlist>
            <listitem>
              <para>
                <emphasis role="strong">Atomia DNS database:</emphasis>
                The main database is by default setup on the SOAP Server, but can be set up on an external machine as well if necessary for policy reasons, as shown in the image above.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">Atomia DNS PowerDNS Nameserver:</emphasis>
            One or more nameservers controlled by the system.
          </para>
          <orderedlist>
            <listitem>
              <para>
                <emphasis role="strong">Sync application:</emphasis>
                Synchronizes data between the Atomia DNS database and the local DNS database on the nameserver. The sync application on the nameserver nodes is provided by the package atomiadns-powerdnssync. The sync application will write data to the local MySQL database.
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="strong">PowerDNS:</emphasis>
                The nameserver software used, can be found at <link xlink:href="http://powerdnssec.org/downloads/packages/">http://powerdnssec.org/downloads/packages/</link>.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">Atomia DNS Bind-DLZ Nameserver:</emphasis>
            One or more nameservers controlled by the system.
            <note>We no longer recommend the Bind-DLZ sync agent, the PowerDNS integration is more actively developed and is a requirement for DNSSEC support</note>
          </para>
          <orderedlist>
            <listitem>
              <para>
                <emphasis role="strong">Sync application:</emphasis>
                Synchronizes data between the Atomia DNS database and the local DNS database on the nameserver. All software on the nameserver nodes is provided by the package atomiadns-nameserver. The sync application will write data to the local database. In the case where the nameserver should get slave zones the sync application will write configurations for BIND.
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="strong">BIND9:</emphasis>
                Nameserver software compiled using database support for quick reload of zone data.
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="strong">BindDLZ/BDBHPT:</emphasis>
                Stores zone data.
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="strong">Zone files:</emphasis>
                Zone files are only used for slave zones where data is loaded from another DNS master server according to the DNS protocol.
              </para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
  </section>
  <section xml:id="features">
    <title>Atomia DNS Features</title>
    <section xml:id="features-mainfeatures">
      <title>Features</title>
      <para>The main features of Atomia DNS are:</para>
      <itemizedlist>
        <listitem>
          <para>
            <emphasis role="strong">Programmatic interface:</emphasis>
            you can integrate Atomia DNS with your application by using the SOAP interface of Atomia DNS.
          </para>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">Scalability:</emphasis>
            you can scale the DNS system up by adding more servers.
          </para>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">Realtime updates:</emphasis>
            Support for massive amounts of zones without reconfiguration downtime
          </para>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">Always valid DNS-data:</emphasis>
            it is impossible to add bad zone-data to the database
          </para>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">Several data centers:</emphasis>
            administrate DNS servers in different data centers
          </para>
        </listitem>
      </itemizedlist>
      <para>
        <informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/Atomia_DNS_overview_infrastructure_v3.png" width="100%" />
            </imageobject>
          </mediaobject>
        </informalfigure>
        <?linebreak?>
        <emphasis role="italics">This is a example infrastructure setup where DNS servers are placed in different data centers. The Atomia DNS API and Atomia DNS database can either be installed on the same machine (default) or on separate machines.</emphasis>
      </para>
    </section>
    <section xml:id="features-functionality">
      <title>Atomia DNS functionality</title>
      <para>The Atomia DNS system consists of:</para>
      <orderedlist>
        <listitem>
          <para>
            <emphasis role="strong">
              <link linkend="usage-master-server">Atomia DNS Master server</link>
            </emphasis>
            <emphasis role="strong">:</emphasis>
            The master server includes the Atomia DNS API that is used for communicating with nameservers and also used by external applications to provision DNS-data. Also on the master server is the Atomia DNS database which contains DNS-settings for all nameservers. It's possible to install the Atomia DNS API and Atomia DNS database on different machines.
          </para>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">
              <link linkend="usage-powerdns">Atomia DNS PowerDNS Nameserver</link>
            </emphasis>
            <emphasis role="strong">:</emphasis>
            The nameserver includes the popular PowerDNS nameserver configured to use a local MySQL database for zone data. All nameservers will also have the Atomia DNS PowerDNS Sync application installed which provisions changes to the local database and also settings and keys needed for DNSSEC.
          </para>
        </listitem>
        <listitem>
          <para>
            <emphasis role="strong">
              <link linkend="usage-bind-dlz">Optional Atomia DNS Bind-DLZ Nameserver</link>
            </emphasis>
            <emphasis role="strong">:</emphasis>
            The nameserver includes the popular BIND nameserver configured to use a local database instead of zone files. All nameservers will also have the Atomia DNS Sync application installed which provisions changes to the local database and also settings for BIND from the data in the Atomia DNS database.
            <note>We no longer recommend the Bind-DLZ sync agent, the PowerDNS integration is more actively developed and is a requirement for DNSSEC support</note>
          </para>
        </listitem>
      </orderedlist>
    </section>
  </section>
  <section xml:id="usage">
    <title>Usage</title>
    <itemizedlist>
      <listitem>
        <para>
          <link linkend="usage-master-server">Atomia DNS Master server</link>
        </para>
      </listitem>
      <listitem>
        <para>
          <link linkend="usage-bind-dlz">Atomia DNS Bind-DLZ Nameserver</link>
        </para>
      </listitem>
      <listitem>
        <para>
          <link linkend="usage-powerdns">Atomia DNS PowerDNS Nameserver</link>
        </para>
      </listitem>
      <listitem>
        <para>
          <link linkend="usage-dyndns">Atomia DNS DynDNS</link>
        </para>
      </listitem>
    </itemizedlist>
    <section xml:id="usage-master-server">
      <title>Atomia DNS Master server</title>
      <section xml:id="usage-master-whatis">
        <title>What is the Atomia DNS Master server?</title>
        <para>The master server includes the Atomia DNS API that is used for communicating with the nameservers and also used by external applications to provision DNS data. Also on the master server is the Atomia DNS database which contains DNS settings for all nameservers. It is possible to install the Atomia DNS API and Atomia DNS database on different machines.</para>
      </section>
      <section xml:id="usage-master-docs">
        <title>Atomia DNS Master server documentation</title>
        <para>Please locate the desired information in one of the following sections:</para>
        <itemizedlist>
          <listitem>
            <para>
              <link linkend="usage-master-installation">Atomia DNS Master server installation</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-master-configuration">Atomia DNS Master server configuration</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-master-updates">Atomia DNS Master server updates</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-master-usage">Atomia DNS Master server usage</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-master-techinfo">Atomia DNS Master server technical information</link>
            </para>
          </listitem>
        </itemizedlist>
      </section>
      <section xml:id="usage-master-installation">
        <title>Atomia DNS Master server installation</title>
        <section xml:id="usage-master-installation-types">
          <title>Installation</title>
          <para>The Atomia DNS Master server consists of two different parts, the Atomia DNS database and the Atomia DNS API. It is possible to install the Atomia DNS Master server either with the database and the API on the same machine or on different machines. The default and recommended way is to install both on the same machine. In addition, if you want to use DNSSEC, it consists of an optional step where you add the initial DNSSEC keyset.</para>
          <section xml:id="usage-master-installation-default-header">
            <title>Default installation</title>
            <para>The default installation will install both the Atomia DNS database and the Atomia DNS API.</para>
            <para>
              See
              <link linkend="usage-master-installation-default">Atomia DNS Master server default installation</link>
              for instructions.
            </para>
          </section>
          <section xml:id="usage-master-installation-manual-header">
            <title>Manual installation</title>
            <para>Using the manual installation guide you can install separate packages and have the Atomia DNS database and the Atomia DNS API on separate machines.</para>
            <para>
              See
              <link linkend="usage-master-installation-manual">Atomia DNS Master server manual installation</link>
              for instructions.
            </para>
          </section>
          <section xml:id="usage-master-installation-dnssec-header">
            <title>Creating the initial DNSSEC keyset</title>
            <para>For using DNSSEC you need to create the initial keys used to sign your zones.</para>
            <para>
              See
              <link linkend="usage-master-installation-dnssec">Creating the initial DNSSEC keyset</link>
              for instructions.
            </para>
          </section>
        </section>
        <section xml:id="usage-master-installation-schema">
          <title>The database schema</title>
          <para>
            The package will create a database called
            <emphasis role="italics">zonedata</emphasis>
            if it doesn't exist, and create the schema there.
          </para>
          <para>If the database already exists, there are two cases:</para>
          <orderedlist>
            <listitem>
              <para>The schema is already installed correctly and the installer proceeds.</para>
            </listitem>
            <listitem>
              <para>The database contains something which is not a version of the Atomia DNS schema and the installer fails.</para>
            </listitem>
          </orderedlist>
          <para>
            To be able to install the product if you already have a database called
            <emphasis role="italics">zonedata</emphasis>
            you need to remove or rename that database, or manually install the latest version of the schema to the database, then rerun the installer.
          </para>
        </section>
        <section xml:id="usage-master-installation-software">
          <title>Software used by Atomia DNS Master server</title>
          <para>On the Atomia DNS Master server the following software is needed (in the recommended installation with Atomia DNS API and Atomia DNS database on the same machine):</para>
          <itemizedlist>
            <listitem>
              <para>
                <emphasis role="italics">Atomia::DNS::Server</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">Apache2 with mod_perl2</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">Postgresql 8.3 or later</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">DBD::Pg 2.11.7 or later</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">SOAP::Lite 0.810.08 or later</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">Moose</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">Config::General</emphasis>
              </para>
            </listitem>
          </itemizedlist>
          <para>
            All needed software, including prerequisites, is installed by the provided package,
            <emphasis role="italics">atomiadns-masterserver</emphasis>
            .
          </para>
        </section>
        <section xml:id="usage-master-installation-default">
          <title>Atomia DNS Master server default installation</title>
          <itemizedlist>
            <listitem>
              <para>
                <link linkend="usage-master-installation-default-intro">Introduction</link>
              </para>
            </listitem>
            <listitem>
              <para>
                <link linkend="usage-master-installation-default-ubuntu">Installation on Ubuntu 10.04 LTS</link>
              </para>
            </listitem>
            <listitem>
              <para>
                <link linkend="usage-master-installation-default-freebsd">Installation on FreeBSD</link>
              </para>
            </listitem>
            <listitem>
              <para>
                <link linkend="usage-master-installation-default-rhel4">Installation on Redhat Enterprise Linux 4</link>
              </para>
            </listitem>
            <listitem>
              <para>
                <link linkend="usage-master-installation-default-rhel5">Installation on Redhat Enterprise Linux 5</link>
              </para>
            </listitem>
            <listitem>
              <para>
                <link linkend="usage-master-installation-default-rhel6">Installation on Redhat Enterprise Linux 6</link>
              </para>
            </listitem>
            <listitem>
              <para>
                <link linkend="usage-master-installation-default-troubleshoot">Installation troubleshooting</link>
              </para>
            </listitem>
          </itemizedlist>
          <section xml:id="usage-master-installation-default-intro">
            <title>Introduction</title>
            <para>This guide will install the Atomia DNS Master server using a default installation. This means that both the Atomia DNS database and Atomia DNS API will be installed.</para>
          </section>
          <section xml:id="usage-master-installation-default-ubuntu">
            <title>Installation on Ubuntu 10.04 LTS</title>
            <orderedlist>
              <listitem>
                <para>
                  Do a standard installation of Ubuntu 10.04 LTS.
                </para>
              </listitem>
              <listitem>
                <para>
                  Add the Atomia APT Repository to the server using:
                  <programlisting>wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</programlisting>
                </para>
              </listitem>
              <listitem>
                <para>Update all packages:</para>
                <informalexample>
                  <programlisting>apt-get update</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Install the Atomia DNS Master:</para>
                <informalexample>
                  <programlisting>apt-get install atomiadns-masterserver</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Add the initial DNSSEC keyset (optional):</para>
            	<para>
			See <link linkend="usage-master-installation-dnssec">Creating the initial DNSSEC keyset</link> for instructions.
		</para>
              </listitem>
            </orderedlist>
          </section>
          <section xml:id="usage-master-installation-default-freebsd">
            <title>Installation on FreeBSD</title>
            <orderedlist>
              <listitem>
                <para>
                  Do a standard installation of FreeBSD. The instructions where tested with FreeBSD 10.0-RELEASE, but should work on
                  other versions as well.
                </para>
              </listitem>
              <listitem>
                <para>
                  Make sure you have an up-to-date ports collection, as described in
                  <link xlink:href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/updating-upgrading-portsnap.html">the FreeBSD handbook</link>.
                </para>
              </listitem>
              <listitem>
                <para>
		  <note>This step is only neccessary as long as the Atomia DNS ports are not in the main ports collection</note>
		  <informalexample>
		  	<programlisting>cd /usr/ports/dns ; fetch -q -o - http://atomiadns.com/tarballs/bleeding.tar.gz | tar xvfpz - --strip-components 2 "*/freebsd"</programlisting>
		  </informalexample>
                </para>
              </listitem>
              <listitem>
                <para>Install PostgreSQL:</para>
                <informalexample>
                  <programlisting>
                  	cd /usr/ports/databases/postgresql91-server
                  	make BATCH=yes install
			echo 'postgresql_enable="YES"' >> /etc/rc.conf
			/usr/local/etc/rc.d/postgresql initdb
			/usr/local/etc/rc.d/postgresql start
                 </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Install Atomia DNS:</para>
		<note>Make sure that your hostname exists in DNS or in /etc/hosts, otherwise the install might fail due to Apache complaining.</note>
                <informalexample>
                  <programlisting>
			cd /usr/ports/dns/atomiadns-database
			make BATCH=yes install
			test x"$SHELL" = x"/bin/bash" &amp;&amp; hash -r ; echo "$SHELL" | grep csh > /dev/null &amp;&amp; rehash
			atomiadns-sync-database
			cd /usr/ports/dns/atomiadns-api
			echo "DEFAULT_VERSIONS+=apache=2.2" >> /etc/make.conf
			make BATCH=yes install
			cd /usr/ports/dns/atomiadns-client
			make BATCH=yes install
			echo 'apache22_enable="YES"' >> /etc/rc.conf
                 </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Optionally password protect the Atomia DNS installation (very much recommended):</para>
                <informalexample>
                  <programlisting linenumbering="unnumbered">
                  	cat > /usr/local/etc/apache22/Includes/atomiadns_password_protect.conf &lt;&lt;EOF
                  	&lt;Location /&gt;
				AuthUserFile /usr/local/etc/apache22/atomiadns.htpasswd
				AuthName "Atomia DNS"
				AuthType Basic
				require valid-user
			&lt;/Location&gt;
                  	EOF
                  	# Remember the password that you enter, it is used in the next step, and later when you add nameservers.
                  	htpasswd -c /usr/local/etc/apache22/atomiadns.htpasswd atomiadns
                  	apachectl graceful
                 </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Test the installation by creating your first (and often only) nameserver group:</para>
                <informalexample>
                  <programlisting>
			echo 'soap_username=YOUR_OPTIONAL_BUT_OBVIOUSLY_HIGHLY_RECOMMENDED_API_SERVER_USERNAME' >> /etc/atomiadns.conf
			echo 'soap_password=YOUR_OPTIONAL_BUT_OBVIOUSLY_HIGHLY_RECOMMENDED_API_SERVER_PASSWORD' >> /etc/atomiadns.conf
                  	atomiadnsclient --method AddNameserverGroup --arg default
                 </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Add the initial DNSSEC keyset (optional):</para>
            	<para>
			See <link linkend="usage-master-installation-dnssec">Creating the initial DNSSEC keyset</link> for instructions.
		</para>
              </listitem>
            </orderedlist>
          </section>
          <section xml:id="usage-master-installation-default-rhel4">
			<note>We no longer recommend Redhat Enterprise Linux 4, latest version supported is Redhat Enterprise Linux 6</note>
            <title>Installation on Redhat Enterprise Linux 4</title>
            <orderedlist>
              <listitem>
                <para>First setup the needed repositories.</para>
                <informalexample>
                  <programlisting>rpm -Uhv http://apt.sw.be/redhat/el4/en/i386/rpmforge/RPMS/rpmforge-release-0.3.6-1.el4.rf.i386.rpm
rpm -Uhv http://yum.pgsqlrpms.org/reporpms/8.4/pgdg-redhat-8.4-1.noarch.rpm
rpm -Uhv http://rpm.atomia.com/rhel4/atomia-repository-setup-1.0-1.noarch.rpm
                  </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Next install the Atomia DNS master server</para>
                <informalexample>
                  <programlisting>up2date -i atomiadns-masterserver</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Allow md5 authentication instead of ident for connections to 127.0.0.1/32 in /var/lib/pgsql/data/pg_hba.conf, example row:</para>
                <informalexample>
                  <programlisting>host    all         all         127.0.0.1/32          md5</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Restart postgresql:</para>
                <informalexample>
                  <programlisting>service postgresql restart</programlisting>
                </informalexample>
              </listitem>
            </orderedlist>
          </section>
          <section xml:id="usage-master-installation-default-rhel5">
            <title>Installation on Redhat Enterprise Linux 5</title>
			<note>We no longer recommend Redhat Enterprise Linux 5, latest version supported is Redhat Enterprise Linux 6</note>
            <orderedlist>
              <listitem>
                <para>First setup the needed repositories.</para>
                <informalexample>
                  <programlisting>rpm -Uhv http://apt.sw.be/redhat/el5/en/i386/rpmforge/RPMS/rpmforge-release-0.3.6-1.el5.rf.i386.rpm
rpm -Uhv http://yum.pgsqlrpms.org/reporpms/8.4/pgdg-redhat-8.4-1.noarch.rpm
rpm -Uhv http://rpm.atomia.com/rhel5/atomia-repository-setup-1.0-1.noarch.rpm
                  </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Next install the Atomia DNS master server</para>
                <informalexample>
                  <programlisting>yum install atomiadns-masterserver</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Allow md5 authentication instead of ident for connections to 127.0.0.1/32 in /var/lib/pgsql/data/pg_hba.conf, example row:</para>
                <informalexample>
                  <programlisting>host    all         all         127.0.0.1/32          md5</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Restart postgresql:</para>
                <informalexample>
                  <programlisting>service postgresql restart</programlisting>
                </informalexample>
              </listitem>
            </orderedlist>
          </section>
          <section xml:id="usage-master-installation-default-rhel6">
            <title>Installation on Redhat Enterprise Linux 6</title>
            <orderedlist>
              <listitem>
                <para>First setup the needed repositories.</para>
                <informalexample>
                  <programlisting>rpm -Uhv http://apt.sw.be/redhat/el6/en/i386/rpmforge/RPMS/rpmforge-release-0.5.2-2.el6.rf.i686.rpm
rpm -Uhv http://yum.pgsqlrpms.org/reporpms/8.4/pgdg-redhat-8.4-1.noarch.rpm
rpm -Uhv http://public.rpm.atomia.com/rhel6/atomia-public-repository-setup-1.0-1.el6.noarch.rpm
                  </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Next install the Atomia DNS master server</para>
                <informalexample>
                  <programlisting>yum install atomiadns-masterserver</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Allow md5 authentication instead of ident for connections to 127.0.0.1/32 in /var/lib/pgsql/data/pg_hba.conf, example row:</para>
                <informalexample>
                  <programlisting>host    all         all         127.0.0.1/32          md5</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Restart postgresql:</para>
                <informalexample>
                  <programlisting>service postgresql restart</programlisting>
                </informalexample>
              </listitem>
            </orderedlist>
          </section>
          <section xml:id="usage-master-installation-default-troubleshoot">
            <title>Installation troubleshooting</title>
          </section>
        </section>
        <section xml:id="usage-master-installation-manual">
          <title>Atomia DNS Master server manual installation</title>
          <para>This guide will install the Atomia DNS Master server with the Atomia DNS database on a separate server from the Atomia DNS API.</para>
          <section xml:id="usage-master-installation-manual-ubuntu">
            <title>Installation on Ubuntu 10.04 LTS</title>
            <orderedlist>
              <listitem>
                <para>
                  Do a standard installation of Ubuntu 10.04 LTS on two servers.
                </para>
              </listitem>
              <listitem>
                <para>On both servers:</para>
                <orderedlist>
                  <listitem>
                    <para>
                  	Add the Atomia APT Repository to the server using:
	                <programlisting>wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</programlisting>
                    </para>
                  </listitem>
                  <listitem>
                    <para>Update all packages:</para>
                    <informalexample>
                      <programlisting>apt-get update</programlisting>
                    </informalexample>
                  </listitem>
                </orderedlist>
              </listitem>
              <listitem>
                <para>Assign one of the servers to be Atomia DNS database server, on that server execute the following steps:</para>
                <orderedlist>
                  <listitem>
                    <para>Install the Atomia DNS database:</para>
                    <informalexample>
                      <programlisting>apt-get install atomiadns-database</programlisting>
                    </informalexample>
                  </listitem>
                </orderedlist>
              </listitem>
              <listitem>
                <para>Assign one of the servers to be Atomia DNS API server, on that server execute the following steps:</para>
                <orderedlist>
                  <listitem>
                    <para>Install the Atomia DNS API:</para>
                    <informalexample>
                      <programlisting>apt-get install atomiadns-api</programlisting>
                    </informalexample>
                  </listitem>
                </orderedlist>
              </listitem>
            </orderedlist>
          </section>
        </section>
        <section xml:id="usage-master-installation-dnssec">
          <title>Creating the initial DNSSEC keyset</title>
          <para>If you want all zones to be signed, then after the Atomia DNS API server is installed you need to create the initial DNSSEC key set.
          In addition you will need to use a nameserver synchronization agent that supports DNSSEC; at the moment this means the PowerDNS agent.</para>
          <para>The DNSSEC setup is completed by executing the following steps:</para>
          <orderedlist>
            <listitem><para>Install the command line client:</para><informalexample><programlisting>apt-get install atomiadns-client</programlisting></informalexample></listitem>
            <listitem><para>Add the active key signing key:</para><informalexample><programlisting>atomiadnsclient --method AddDNSSECKey --arg RSASHA256 --arg 2048 --arg KSK --arg 1</programlisting></informalexample></listitem>
            <listitem><para>Add the active zone signing key:</para><informalexample><programlisting>atomiadnsclient --method AddDNSSECKey --arg RSASHA256 --arg 1024 --arg ZSK --arg 1</programlisting></informalexample></listitem>
            <listitem><para>Add the inactive zone signing key:</para><informalexample><programlisting>atomiadnsclient --method AddDNSSECKey --arg RSASHA256 --arg 1024 --arg ZSK --arg 0</programlisting></informalexample></listitem>
          </orderedlist>
		  <note>Warning: The suggested workaround for random number generation in virtual machines will produce easily predictable and
		  insecure DNSSEC keys. For production purposes, please solve it in a secure way. You have been warned.</note>
		  <note>Adding DNSSEC keys on a virtual machine where you can't use keyboard input to generate entropy requires an additional step.</note>
		  <para>Install rng-tools using <code>apt-get install rng-tools</code>, then open <code>/etc/default/rng-tools</code> and add the following line, or better something equivalent but secure:</para>
		  <informalexample>
			<programlisting>
				# WARNING: This setup is insecure, you should make sure that you have an adequate setup 
				# for generating cryptographically strong random numbers instead.
				HRNGDEVICE = /dev/urandom
			</programlisting>
		  </informalexample>
		  <para>Now, they key creation should be instant. Notice though that this setup is really insecure. You should instead configure rng-tools to provide sufficient amounts of random numbers in a secure way, e.g. by having better hardware for generating entropy.</para>
        </section>
      </section>
      <section xml:id="usage-master-configuration">
        <title>Atomia DNS Master server configuration</title>
        <para>If you use the recommended setup for the Atomia DNS Master server you don't need to edit the config file. A password is generated when creating the non-existing schema when the package is installed.</para>
        <section xml:id="usage-master-configuration-file">
          <title>Configuration file</title>
          <para>
            The config file used by Atomia DNS API is placed at
            <code>/etc/atomiadns.conf</code>
            and contains the following settings:
          </para>
          <informaltable>
            <colgroup />
            <thead>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>Parameter</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Example</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Description</para>
                </td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>db_name</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>zonedata</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>The name of the database.</para>
                </td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>db_hostname</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>localhost</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>The hostname where the database is running.</para>
                </td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>db_username</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>atomiadns</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Username of the database.</para>
                </td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>db_password</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>password_for_the_username</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Password for the database.</para>
                </td>
              </tr>
            </tbody>
          </informaltable>
          <para>Default config file:</para>
          <informalexample>
            <programlisting>db_name = zonedata
db_hostname = localhost
db_username = atomiadns
db_password = autogeneratedpassword
            </programlisting>
          </informalexample>
        </section>
      </section>
      <section xml:id="usage-master-updates">
        <title>Atomia DNS Master server updates</title>
        <itemizedlist>
          <listitem>
            <para>
              <link linkend="usage-master-updates-intro">Introduction</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-master-updates-ubuntu">Updates on Ubuntu 10.04 LTS</link>
            </para>
            <itemizedlist>
              <listitem>
                <para>
                  <link linkend="usage-master-updates-where">Where to get updates?</link>
                </para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-master-updates-rhel">Updates on Redhat Enterprise Linux</link>
            </para>
            <itemizedlist>
              <listitem>
                <para>
                  <link linkend="usage-master-update-rhel-where">Where to get updates?</link>
                </para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
        <section xml:id="usage-master-updates-intro">
          <title>Introduction</title>
          <para>Updates are done by installing the latest version of the installed packages.</para>
          <para>Any change in the dependencies will be handled appropriately by the installation package, upgrading or installing them as needed.</para>
          <para>If the database schema has changed, the schema on the Atomia DNS Master server will be automatically updated. If you have chosen to have the database on a separate server, you will have to update the atomiadns-database package on that server as well. All schema changes are noted in the release notes for the new version.</para>
        </section>
        <section xml:id="usage-master-updates-ubuntu">
          <title>Updates on Ubuntu 10.04 LTS</title>
          <para>To install an update, complete the following steps:</para>
          <orderedlist>
            <listitem>
              <para>Update all packages:</para>
              <informalexample>
                <programlisting>apt-get update</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Note the version number of the package currently installed.</para>
            </listitem>
            <listitem>
              <para>Install updates using:</para>
              <informalexample>
                <programlisting>apt-get install atomiadns-masterserver</programlisting>
              </informalexample>
            </listitem>
          </orderedlist>
          <para>If you for some reason want to rollback to the previous version, then run:</para>
          <informalexample>
            <programlisting>apt-get install atomiadns-masterserver=version-number-noted</programlisting>
          </informalexample>
          <section xml:id="usage-master-updates-where">
            <title>Where to get updates?</title>
            <para>
              Updates are distributed using the Atomia APT repository.
		If not done, then add the Atomia APT Repository to the server using:
		<programlisting>wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</programlisting>
            </para>
          </section>
        </section>
        <section xml:id="usage-master-updates-rhel">
          <title>Updates on Redhat Enterprise Liux</title>
          <para>To install an update, complete the following steps:</para>
          <orderedlist>
            <listitem>
              <para>Clean the cache so that you are sure that you get the latest:</para>
              <informalexample>
                <programlisting>yum clean expire-cache --disablerepo "*" --enablerepo atomia</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Upgrade the package:</para>
              <informalexample>
                <programlisting>yum install atomiadns-masterserver</programlisting>
              </informalexample>
            </listitem>
          </orderedlist>
          <section xml:id="usage-master-update-rhel-where">
            <title>Where to get updates?</title>
            <para>
              Updates are distributed using the Atomia RPM repository.
            </para>
          </section>
        </section>
      </section>
      <section xml:id="usage-master-usage">
        <title>Atomia DNS Master server usage</title>
        <section xml:id="usage-master-usage-api">
          <title>Atomia DNS API</title>
          <para>
            The Atomia DNS Master server is administrated using an API which you can use to create a web interface or other applications. For information on how the API works and how to use it see
            <link linkend="apidocs">Atomia DNS API</link>
            .
          </para>
        </section>
        <section xml:id="usage-master-dyndns">
          <title>Atomia DNS DynDNS</title>
          <para>
            The Atomia DNS DynDNS client is used to handle DynDNS updates according to the DNS protocol. The client acts as a regular nameserver but only has support for DynDNS updates. For information on how DynDNS works and how to use it see
            <link linkend="usage-dyndns">Atomia DNS DynDNS</link>
            .
          </para>
        </section>
      </section>
      <section xml:id="usage-master-techinfo">
        <title>Master database</title>
        <para>
          The schema for the Atomia DNS database can be found on the
          <link linkend="usage-master-server">Atomia DNS Master server</link>
          in
          <code>/usr/share/atomiadns/schema</code>
          .
        </para>
        <para>It contains the following tables:</para>
        <informaltable>
          <colgroup />
          <thead>
            <tr>
              <td rowspan="1" colspan="1">
                <para>Table</para>
              </td>
              <td rowspan="1" colspan="1">
                <para>Description</para>
              </td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <para>allowed_type</para>
              </td>
              <td rowspan="1" colspan="1">
                <para>Ccontains a list of allowed DNS types together with regular expressions for validating data.</para>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <para>updates_disabled</para>
              </td>
              <td rowspan="1" colspan="1">
                <para>Always contains a single row stating if updates to the nameservers are disabled or enabled.</para>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <para>nameserver</para>
              </td>
              <td rowspan="1" colspan="1">
                <para>Contains one row of all nameservers subscribing to this data set.</para>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <para>change</para>
              </td>
              <td rowspan="1" colspan="1">
                <para>Contains one row for every changed zone per nameserver that hasn't propagated the change yet.</para>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <para>zone</para>
              </td>
              <td rowspan="1" colspan="1">
                <para>Contains the zone name and a primary key.</para>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <para>label</para>
              </td>
              <td rowspan="1" colspan="1">
                <para>Contains the label name, a foreign key mapping the label to a zone and a primary key.</para>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <para>record</para>
              </td>
              <td rowspan="1" colspan="1">
                <para>Contains the record data, a foreign key mapping the record to a label and a primary key.</para>
              </td>
            </tr>
          </tbody>
        </informaltable>
        <para>
          It also contains a number of triggers for validating data and one stored procedure for every method in the
          <link linkend="apidocs">Atomia DNS API</link>
          .
        </para>
      </section>
    </section>
    <section xml:id="usage-bind-dlz">
      <title>Atomia DNS Bind-DLZ Nameserver</title>
      <section xml:id="usage-bind-dlz-whatis">
        <title>What is the Atomia DNS Bind-DLZ Nameserver?</title>
        <note>We no longer recommend the Bind-DLZ sync agent, the PowerDNS integration is more actively developed and is a requirement for DNSSEC support</note>
        <para>The nameserver includes the popular BIND nameserver configured to use a local database instead of zone files. All nameservers will also have the Atomia DNS Sync application installed which provisions changes to the local database and also settings for BIND from the data in the Atomia DNS database.</para>
      </section>
      <section xml:id="usage-bind-dlz-docs">
        <title>Atomia DNS Bind-DLZ Nameserver documentation</title>
        <para>Please locate the desired information in one of the following sections:</para>
        <itemizedlist>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-installation">Atomia DNS Bind-DLZ Nameserver installation</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-configuration">Atomia DNS Bind-DLZ Nameserver configuration</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-updates">Atomia DNS Bind-DLZ Nameserver updates</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-usage">Atomia DNS Bind-DLZ Nameserver usage</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-techinfo">Atomia DNS Bind-DLZ Nameserver technical information</link>
            </para>
          </listitem>
        </itemizedlist>
      </section>
      <section xml:id="usage-bind-dlz-installation">
        <title>Atomia DNS Bind-DLZ Nameserver installation</title>
        <itemizedlist>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-installation-intro">Introduction</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-installation-ubuntu">Installation on Ubuntu LTS</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-installation-rhel4">Installation on Redhat Enterprise Linux 4</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-installation-software">Software used by Atomia DNS Bind-DLZ Nameserver</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-bind-dlz-installation-troubleshoot">Installation troubleshooting</link>
            </para>
          </listitem>
        </itemizedlist>
        <section xml:id="usage-bind-dlz-installation-intro">
          <title>Introduction</title>
          <para>This guide will install the Atomia DNS Bind-DLZ Nameserver.</para>
        </section>
        <section xml:id="usage-bind-dlz-installation-ubuntu">
          <title>Installation on Ubuntu LTS</title>
          <orderedlist>
            <listitem>
              <para>Install the latest Ubuntu LTS relase.</para>
            </listitem>
            <listitem>
              <para>
                  	Add the Atomia APT Repository to the server using:
	                <programlisting>wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</programlisting>
              </para>
            </listitem>
            <listitem>
              <para>Install the Bind-DLZ package we provide:</para>
              <informalexample>
                <programlisting>apt-get install bind9-dlz-bdbhpt</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Install the Atomia DNS Bind-DLZ Nameserver:</para>
              <informalexample>
                <programlisting>apt-get install atomiadns-nameserver</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Install the Atomia DNS Client utility:</para>
              <informalexample>
                <programlisting>apt-get install atomiadns-client</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Edit the configuration file:</para>
              <informalexample>
                <programlisting>edit /etc/atomiadns.conf</programlisting>
              </informalexample>
              <orderedlist>
                <listitem>
                  <para>Change the soap_uri row to contain the hostname of your Atomia DNS Master server</para>
                </listitem>
                <listitem>
                  <para>Add a row looking like 'server_name = hostname of this node'</para>
                </listitem>
                <listitem>
                  <para>Example configuration:</para>
                  <informalexample>
                    <programlisting>servername = your.name.server
soap_uri = https://your.atomia.dns.master.server.com/atomiadns
soap_cacert = /etc/atomiadns_soap_cert.crt
soap_username = atomia
soap_password = XXXXXX
bdb_environment_path = /var/lib/bind/atomiadns_bdb
bdb_filename = dns_data.db
rndc_path = /usr/sbin/rndc
slavezones_config = /etc/bind/slave/named-slavezones.conf.local
slavezones_dir = /etc/bind/slave/zones
                    </programlisting>
                  </informalexample>
                </listitem>
              </orderedlist>
            </listitem>
            <listitem>
              <para>If this is the first server in it's nameserver group, then add the group (substitute groupname):</para>
              <informalexample>
                <programlisting>atomiadnsclient --method AddNameserverGroup --arg groupname</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Add the nameserver as a subscriber of the zones in the configured Atomia DNS Master server (substitute groupname):</para>
              <informalexample>
                <programlisting>atomiadnssync add_server groupname</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Start the daemon that fetches updates and replicates those to the local zone database:</para>
              <informalexample>
                <programlisting>/etc/init.d/atomiadns-nameserver start</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Initiate a full reload of all zones in the Atomia DNS Master sever (all nameservers are reloaded):</para>
              <informalexample>
                <programlisting>atomiadnssync full_reload_online</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Start BIND:</para>
              <informalexample>
                <programlisting>/etc/init.d/bind9-dlz-bdbhpt start</programlisting>
              </informalexample>
            </listitem>
          </orderedlist>
        </section>
        <section xml:id="usage-bind-dlz-installation-rhel4">
          <title>Installation on Redhat Enterprise Linux 4</title>
          <orderedlist>
            <listitem>
              <para>First setup GPG-keys for the needed repositories.</para>
              <informalexample>
				<programlisting>rpm -Uhv http://apt.sw.be/redhat/el4/en/i386/rpmforge/RPMS/rpmforge-release-0.3.6-1.el4.rf.i386.rpm
rpm -Uhv http://rpm.atomia.com/rhel4/atomia-repository-setup-1.0-1.noarch.rpm
                </programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Then configure up2date to use them, by adding to /etc/sysconfig/rhn/sources:</para>
              <informalexample>
                <programlisting>yum atomia http://rpm.atomia.com/rhel4
yum dag http://apt.sw.be/redhat/el4/en/$ARCH/dag
                </programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Install the Atomia DNS master server:</para>
              <informalexample>
                <programlisting>up2date -i atomiadns-nameserver</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Install the Atomia DNS Client utility:</para>
              <informalexample>
                <programlisting>up2date -i atomiadns-client</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Edit the configuration file:</para>
              <informalexample>
                <programlisting>edit /etc/atomiadns.conf</programlisting>
              </informalexample>
              <orderedlist>
                <listitem>
                  <para>Change the soap_uri row to contain the hostname of your Atomia DNS Master server</para>
                </listitem>
                <listitem>
                  <para>Add a row looking like 'server_name = hostname of this node'</para>
                </listitem>
                <listitem>
                  <para>Example configuration:</para>
                  <informalexample>
                    <programlisting>servername = your.name.server
soap_uri = https://your.atomia.dns.master.server.com/atomiadns
soap_cacert = /etc/atomiadns_soap_cert.crt
soap_username = atomia
soap_password = XXXXXX
bdb_environment_path = /var/lib/bind/atomiadns_bdb
bdb_filename = dns_data.db
rndc_path = /usr/sbin/rndc
slavezones_config = /etc/bind/slave/named-slavezones.conf.local
slavezones_dir = /etc/bind/slave/zones
                    </programlisting>
                  </informalexample>
                </listitem>
              </orderedlist>
            </listitem>
            <listitem>
              <para>If this is the first server in it's nameserver group, then add the group (substitute groupname):</para>
              <informalexample>
                <programlisting>atomiadnsclient --method AddNameserverGroup --arg groupname</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Add the nameserver as a subscriber of the zones in the configured Atomia DNS Master server (substitute groupname):</para>
              <informalexample>
                <programlisting>atomiadnssync add_server groupname</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Start the daemon that fetches updates and replicates those to the local zone database:</para>
              <informalexample>
                <programlisting>service atomiadnssync start</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Initiate a full reload of all zones in the Atomia DNS Master sever (all nameservers are reloaded):</para>
              <informalexample>
                <programlisting>atomiadnssync full_reload_online</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Start BIND:</para>
              <informalexample>
                <programlisting>service bind start</programlisting>
              </informalexample>
            </listitem>
          </orderedlist>
        </section>
        <section xml:id="usage-bind-dlz-installation-software">
          <title>Software used by Atomia DNS Bind-DLZ Nameserver</title>
          <para>On the nameservers the following software is needed:</para>
          <itemizedlist>
            <listitem>
              <para>
                <emphasis role="italics">Config::General</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">SOAP::Lite</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">Moose</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">BerkeleyDB</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">Bind9 compiled with DLZ and the bdbhpt driver linked to the same bdb-version as the BerkeleyDB module</emphasis>
              </para>
            </listitem>
          </itemizedlist>
          <para>
            All needed software, including prerequisites are installed by the provided package,
            <emphasis role="italics">atomiadns-nameserver</emphasis>
            .
          </para>
        </section>
        <section xml:id="usage-bind-dlz-installation-troubleshoot">
          <title>Installation troubleshooting</title>
        </section>
      </section>
      <section xml:id="usage-bind-dlz-configuration">
        <title>Atomia DNS Bind-DLZ Nameserver configuration</title>
        <para>You have to configure the Atomia DNS Bind-DLZ Nameserver to fit your environment.</para>
        <section xml:id="usage-bind-dlz-configuration-file">
          <title>Configuration file</title>
          <para>
            The config file used by Atomia DNS Bind-DLZ Nameserver is placed in
            <code>/etc/atomiadns.conf</code>
            and contains the following settings:
          </para>
          <informaltable>
            <colgroup />
            <thead>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>Parameter</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Example</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Description</para>
                </td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>bdb_environment_path</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>/var/lib/bind/atomiadns_bdb</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Path where the database should be stored.</para>
                </td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>soap_uri</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>
                    <link xlink:href="http://hostname.of.your.soap.server/atomiadns">http://hostname.of.your.soap.server/atomiadns</link>
                  </para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>URI of the Atomia DNS API.</para>
                </td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>bdb_filename</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>dns_data.db</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Filename of the database.</para>
                </td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>servername</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>ns1.yourhost.com</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Hostname of the nameserver.</para>
                </td>
              </tr>
            </tbody>
          </informaltable>
          <para>soap_uri and servername always needs to be changed. For the other two parameters, the default settings will work.</para>
          <para>Default config file:</para>
          <informalexample>
            <programlisting>bdb_environment_path = /var/lib/bind/atomiadns_bdb
soap_uri = http://your.atomia.dns.master.server.com/atomiadns
bdb_filename = dns_data.db
servername = your.name.server
slavezones_config = /etc/bind/slave/named-slavezones.conf.local
slavezones_dir = /etc/bind/slave/zones
            </programlisting>
          </informalexample>
        </section>
        <section xml:id="usage-bind-dlz-scripts">
          <title>Scripts and commands</title>
          <para>
            For more information on how to use the Atomia DNS Sync application see
            <link linkend="usage-bind-dlz-usage">Atomia DNS Bind-DLZ Nameserver usage</link>
            .
          </para>
        </section>
      </section>
      <section xml:id="usage-bind-dlz-updates">
        <title>Atomia DNS Bind-DLZ Nameserver updates</title>
        <para>To install an update, complete the following steps:</para>
        <orderedlist>
          <listitem>
            <para>Update all packages:</para>
            <informalexample>
              <programlisting>apt-get update</programlisting>
            </informalexample>
          </listitem>
          <listitem>
            <para>Note the version number of the package currently installed.</para>
          </listitem>
          <listitem>
            <para>Install updates using:</para>
            <informalexample>
              <programlisting>apt-get install atomiadns-nameserver
/etc/init.d/atomiadns-nameserver restart
              </programlisting>
            </informalexample>
          </listitem>
        </orderedlist>
        <para>If you for some reason want to rollback to the previous version, then run:</para>
        <informalexample>
          <programlisting>apt-get install atomiadns-nameserver=version-number-noted</programlisting>
        </informalexample>
        <para>Any changes in the dependencies will be handled appropriately by the installation package, upgrading or installing them as needed.</para>
        <section xml:id="usage-bind-dlz-updates-where">
          <title>Where to get updates?</title>
          <para>
              Updates are distributed using the Atomia APT repository.
		If not done, then add the Atomia APT Repository to the server using:
		<programlisting>wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</programlisting>
          </para>
        </section>
        <section xml:id="usage-bind-dlz-updates-building-rpms">
          <title>Atomia DNS Building new Bind-DLZ RPMS</title>
          <section xml:id="usage-bind-dlz-updates-building-rpms-instructions">
            <title>Instructions</title>
            <para>To build new RPMS for Bind-DLZ whenever an important new release is made we use the following steps:</para>
            <orderedlist>
              <listitem>
                <para>Login to build machine for the OS release in question (e.g. RHEL5, RHEL4 etc).</para>
              </listitem>
              <listitem>
                <para>
                  Download
                  <link xlink:href="https://raw.github.com/atomia/atomiadns/develop/syncer/bind9_rhel5_rpm.patch">bind9_rhel5_rpm.patch</link>
                  and place it in /usr/src/redhat
                </para>
              </listitem>
              <listitem>
                <para>Checkout redhat package sources:</para>
                <informalexample>
                  <programlisting>cvs -d ":pserver:anonymous@cvs.fedoraproject.org:/cvs/pkgs" co rpms/bind</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Use the latest non-devel version of the spec:</para>
                <informalexample>
                  <programlisting>cd rpms/bind/F-12</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Patch the package sources to include the things we need:</para>
                <informalexample>
                  <programlisting>patch -p1 &lt; /usr/src/redhat/bind9_rhel_rpm.atomia.patch</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Build the SRPM:</para>
                <informalexample>
                  <programlisting>rm *rpm ; make srpm</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Install the sources and SPEC-file:</para>
                <informalexample>
                  <programlisting>rpm -i *rpm</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Build it:</para>
                <informalexample>
                  <programlisting>cd /usr/src/redhat/SPECS &amp;&amp; rpmbuild -bb --sign bind.spec</programlisting>
                </informalexample>
              </listitem>
            </orderedlist>
          </section>
        </section>
      </section>
      <section xml:id="usage-bind-dlz-usage">
        <title>Atomia DNS Bind-DLZ Nameserver usage</title>
        <section xml:id="usage-bind-dlz-usage-syncapp">
          <title>Sync application</title>
          <para>
            The sync application is called atomiadnssync. You can view its manual page
            <link linkend="usage-bind-dlz-usage-syncer-man">here</link>
            or by running:
          </para>
          <informalexample>
            <programlisting>man atomiadnssync</programlisting>
          </informalexample>
        </section>
        <section xml:id="usage-bind-dlz-usage-syncer-man">
          <title>Atomia DNS Sync manual</title>
          <section xml:id="usage-bind-dlz-usage-syncer-man-name">
            <title>NAME</title>
            <para>atomiadnssync - An application for synchronizing a local BDB database with the master zone database using SOAP.</para>
          </section>
          <section xml:id="usage-bind-dlz-usage-syncer-man-synopsis">
            <title>SYNOPSIS</title>
            <para><programlisting>atomiadnssync full_reload_offline SERIAL DESTINATION
atomiadnssync OPTION
            </programlisting></para>
          </section>
          <section xml:id="usage-bind-dlz-usage-syncer-man-description">
            <title>DESCRIPTION</title>
            <para>atomiadnssync is an application for synchronizing a local BDB database with the master zone database using SOAP.</para>
            <para>It contains options for both doing a full reload of all zones in the master database, and for just fetching the zones changed since the last update and reloading those.</para>
            <para>In addition you can use this tool for adding or removing the subscription of updates for a nameserver, and for enabling and disabling propagation of updates globally across all nameservers.</para>
          </section>
          <section xml:id="usage-bind-dlz-usage-syncer-man-options">
            <title>OPTIONS</title>
            <para>
              <code>full_reload_offline SERIAL DESTINATION</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Propagates all zones to a fresh BDB environment stored in the destination folder (should be empty before running). All zones get the serial specified in their SOA-record. This command should always be run with the same user BIND is running as.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>full_reload_online</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Marks all zones as changed so that the update-process propagates them on all nameservers.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>full_reload_slavezones</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Marks all slave zones as changed so that the update-process propagates them on all nameservers.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>updated</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Fetches a list of changed zones and adds/removes them from the local BDB database. This option is used by the daemon started at boot-time by /etc/init.d/atomiadns-nameserver. You should never run this manually.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>add_server</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Adds this server (configured using servername in /etc/atomiadns.conf) as a subscriber of the data set on the configured SOAP server.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>remove_server</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Remove the subscription of the data set on the configured SOAP server for this server (configured using servername in /etc/atomiadns.conf).</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>disable_updates</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Disable propagation of changes to the nameservers.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>enable_updates</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Enable propagation of changes to the nameservers</para>
              </listitem>
            </itemizedlist>
          </section>
          <section xml:id="usage-bind-dlz-usage-syncer-man-configuration">
            <title>CONFIGURATION</title>
            <para>The application is configured using a config file stored at /etc/atomiadns.conf. All options are required.</para>
            <para>The following options exist:</para>
            <para>
              <code>bdb_environment_path</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Specifies the path of the local BDB environment. The default is /var/lib/bind/atomiadns_bdb, and does probably not need to change.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>bdb_filename</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Specifies the filename (relative to bdb_environment_path) of the local BDB database. The default is dns_data.db, and does probably not need to change.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>soap_uri</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Specifies the URI of the SOAP Server to fetch changes from.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>servername</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Specifies the filename which contain a list of the configured slave zones.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>slavezones_config</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Specifies the hostname used when subscribing and checking for changes.</para>
              </listitem>
            </itemizedlist>
            <para>
              <code>slavezones_dir</code>
            </para>
            <itemizedlist>
              <listitem>
                <para>Specifies the directory where zone files for the slave zones are stored.</para>
              </listitem>
            </itemizedlist>
          </section>
          <section xml:id="usage-bind-dlz-usage-syncer-man-examples">
            <title>EXAMPLES</title>
            <para>To do a full reload to a new folder without missing any updates (assuming the default bdb_environment_path), do:</para>
            <para>1. atomiadnssync disable_updates</para>
            <para>2. Verify manually that no pending changes exist.</para>
            <para>3. Write down the output (unix timestamp) of `date +%s`</para>
            <para>4. Run `atomiadnssync full_reload_offline the_timestamp /var/lib/bind/atomiadns_bdb_new</para>
            <para>5. rm -rf /var/lib/bind/atomiadns_bdb_old ; mv /var/lib/bind/atomiadns_bdb /var/lib/bind/atomiadns_bdb_old ; mv /var/lib/bind/atomiadns_bdb_new /var/lib/bind/atomiadns_bdb</para>
            <para>6. rndc reload</para>
            <para>7. atomiadnssync enable_updates</para>
            <para>Or to accomplish the same thing using the online reload feature (much better and the preferred way):</para>
            <para>atomiadnssync full_reload_online</para>
            <para>To add the server as a subscriber:</para>
            <para>atomiadnssync add_server</para>
          </section>
          <section xml:id="usage-bind-dlz-usage-syncer-man-author">
            <title>AUTHOR</title>
            <para>Atomia DNS was developed by Atomia AB. For support, please see <link xlink:href="http://www.atomiadns.com/">http://www.atomiadns.com/</link>.</para>
          </section>
        </section>
      </section>
      <section xml:id="usage-bind-dlz-techinfo">
        <title>BDB databases on the nameservers</title>
        <para>
          On the nameservers the location of the BDB databases is configured in
          <code>/etc/atomiadns</code>
          using
          <code>bdb_environment_path</code>
          and
          <code>bdb_filename</code>
          .
        </para>
        <para>You can use the regular BDB utilities to do things like hot backup and crash recovery.</para>
        <para>
          More information can be found in the BDB documentation, for example:
          <?linebreak?>
          <link xlink:href="http://www.oracle.com/technology/documentation/berkeley-db/db/ref/transapp/archival.html">http://www.oracle.com/technology/documentation/berkeley-db/db/ref/transapp/archival.html</link>
          <?linebreak?>
          <link xlink:href="http://www.oracle.com/technology/documentation/berkeley-db/db/ref/transapp/recovery.html">http://www.oracle.com/technology/documentation/berkeley-db/db/ref/transapp/recovery.html</link>
        </para>
        <para>
          If the BDB databases were to become corrupt, the recommended solution would be to do a full resync of the BDB databases from the master. This is done using the
          <link linkend="usage-bind-dlz-usage-syncapp">atomiadnssync tool</link>
          .
        </para>
      </section>
    </section>
    <section xml:id="usage-powerdns">
      <title>Atomia DNS PowerDNS Nameserver</title>
      <section xml:id="usage-powerdns-whatis">
        <title>What is the Atomia DNS PowerDNS Nameserver?</title>
        <para>The nameserver includes the popular PowerDNS nameserver configured to use a local MySQL database instead of zone files. All PowerDNS nameservers will also have the Atomia DNS PowerDNS Sync application installed which provisions changes to the local database from the data in the Atomia DNS database.</para>
      </section>
      <section xml:id="usage-powerdns-docs">
        <title>Atomia DNS PowerDNS Nameserver documentation</title>
        <para>Please locate the desired information in one of the following sections:</para>
        <itemizedlist>
          <listitem>
            <para>
              <link linkend="usage-powerdns-installation">Atomia DNS PowerDNS Nameserver installation</link>
            </para>
          </listitem>
        </itemizedlist>
      </section>
      <section xml:id="usage-powerdns-installation">
        <title>Atomia DNS PowerDNS Nameserver installation</title>
        <itemizedlist>
          <listitem>
            <para>
              <link linkend="usage-powerdns-installation-intro">Introduction</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-powerdns-installation-ubuntu">Installation on Ubuntu LTS</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-powerdns-installation-freebsd">Installation on FreeBSD</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-powerdns-installation-rhel">Installation on Red Hat Enterprise Linux</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-powerdns-installation-software">Software used by Atomia DNS PowerDNS Nameserver</link>
            </para>
          </listitem>
        </itemizedlist>
        <section xml:id="usage-powerdns-installation-intro">
          <title>Introduction</title>
          <para>This guide will install the Atomia DNS PowerDNS Nameserver.</para>
        </section>
        <section xml:id="usage-powerdns-installation-ubuntu">
          <title>Installation on Ubuntu LTS</title>
          <orderedlist>
            <listitem>
              <para>Install the latest Ubuntu LTS relase.</para>
            </listitem>
            <listitem>
              <para>
                  	Add the Atomia APT Repository to the server using:
	                <programlisting>wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</programlisting>
              </para>
            </listitem>
            <listitem>
              <para>Install the database schema (will also install MySQL):</para>
              <informalexample>
                <programlisting>apt-get install atomiadns-powerdns-database</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>To configure the nameserver to get zones from your Atomia DNS installation, add soap_uri, soap_cacert, soap_username and soap_password to /etc/atomiadns.conf</para>
              <informalexample>
                <programlisting>soap_uri = https://some.server.example.com/atomiadns
soap_cacert = /path/to/CA_cert_that_signed_SSL_cert
soap_username = someuser
soap_password = somepass
                </programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Also to /etc/atomiadns.conf add the subscriber name for this nameserver:</para>
              <informalexample>
                <programlisting>servername = powerdns1</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Install the PowerDNS sync agent:</para>
              <informalexample>
                <programlisting>apt-get install atomiadns-powerdnssync</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Add the nameserver as subscriber of the zones (replace default with whatever server group it is to be member of):</para>
              <informalexample>
                <programlisting>atomiapowerdnssync add_server default</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Start the daemon:</para>
              <informalexample>
                <programlisting>start atomiadns-powerdnssync</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Sync all zones:</para>
              <informalexample>
                <programlisting>atomiapowerdnssync full_reload_online</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>
                Go to
                <link xlink:href="http://powerdnssec.org/downloads/packages/">http://powerdnssec.org/downloads/packages/</link>
                and download the latest .deb package
              </para>
            </listitem>
            <listitem>
              <para>Install it using (replace filename):</para>
              <informalexample>
                <programlisting>dpkg -i pdns-static_3.0-rc1-1_amd64.deb</programlisting>
              </informalexample>
              <orderedlist>
                <listitem>
                  <para>When it asks if you want to replace /etc/powerdns/pdns.conf, just press enter to keep the version that atomiadns-powerdns-database preconfigured for you.</para>
                </listitem>
              </orderedlist>
            </listitem>
          </orderedlist>
        </section>
        <section xml:id="usage-powerdns-installation-freebsd">
            <title>Installation on FreeBSD</title>
            <orderedlist>
              <listitem>
                <para>
                  Do a standard installation of FreeBSD. The instructions where tested with FreeBSD 10.0-RELEASE, but should work on
                  other versions as well.
                </para>
              </listitem>
              <listitem>
                <para>
                  Make sure you have an up-to-date ports collection, as described in
                  <link xlink:href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/updating-upgrading-portsnap.html">the FreeBSD handbook</link>.
                </para>
              </listitem>
              <listitem>
                <para>
		  <note>This step is only neccessary as long as the Atomia DNS ports are not in the main ports collection</note>
		  <informalexample>
		  	<programlisting>cd /usr/ports/dns ; fetch -q -o - http://atomiadns.com/tarballs/bleeding.tar.gz | tar xvfpz - --strip-components 2 "*/freebsd"</programlisting>
		  </informalexample>
                </para>
              </listitem>
              <listitem>
                <para>Install MySQL and create the database:</para>
                <informalexample>
                  <programlisting>
			cd /usr/ports/databases/mysql55-server
			make BATCH=yes install
			echo 'mysql_enable="YES"' &gt;&gt; /etc/rc.conf
			/usr/local/etc/rc.d/mysql-server start
			mysql -u root mysql -e "drop database test; delete from db; delete from user where user = ''; delete from user where host &lt;&lt; 'localhost'; flush privileges"
			mysqladmin create powerdns
			set powerdns_pw=`sh -c 'dd if=/dev/urandom bs=1024 count=1 2&gt; /dev/null | sha1'`
			mysql -u root -e "grant all on powerdns.* to 'powerdns'@'localhost' identified by '$powerdns_pw'"
			cat &gt; /root/pdns.conf.tmp &lt;&lt;EOF
			launch=gmysql
			gmysql-host=localhost
			gmysql-user=powerdns
			gmysql-dbname=powerdns
			gmysql-password=$powerdns_pw
			gmysql-dnssec=yes
			EOF
                 </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Install PowerDNS:</para>
                <informalexample>
                  <programlisting>
			cd /usr/ports/dns/powerdns
			make BATCH=yes WITH_MYSQL=YES WITHOUT_PGSQL=YES install
			echo 'pdns_enable="YES"' &gt;&gt; /etc/rc.conf
			echo 'pdns_flags="--daemon --guardian=yes"' &gt;&gt; /etc/rc.conf
			mv /root/pdns.conf.tmp /usr/local/etc/pdns/pdns.conf
                 </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Install atomiadns-powerdnssync:</para>
                <informalexample>
                  <programlisting>
			cd /usr/ports/dns/atomiadns-powerdnssync
			make BATCH=yes install
			atomiadns-sync-powerdns-database /usr/local/etc/pdns/pdns.conf
			echo "servername = `hostname`" >> /etc/atomiadns.conf
			echo 'soap_uri=http://INSERT_IP_OF_API_SERVER/atomiadns' >> /etc/atomiadns.conf
			echo 'soap_username=YOUR_OPTIONAL_BUT_OBVIOUSLY_HIGHLY_RECOMMENDED_API_SERVER_USERNAME' >> /etc/atomiadns.conf
			echo 'soap_password=YOUR_OPTIONAL_BUT_OBVIOUSLY_HIGHLY_RECOMMENDED_API_SERVER_PASSWORD' >> /etc/atomiadns.conf
			echo 'atomiapowerdnssync_enable="YES"' >> /etc/rc.conf
			atomiapowerdnssync add_server default
			/usr/local/etc/rc.d/atomiapowerdnssync start
			atomiapowerdnssync full_reload_online
                 </programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Start PowerDNS:</para>
                <informalexample>
                  <programlisting>
                  	/usr/local/etc/rc.d/pdns start
                 </programlisting>
                </informalexample>
              </listitem>
            </orderedlist>
        </section>
        <section xml:id="usage-powerdns-installation-rhel">
            <title>Installation on Red Hat Enterprise Linux</title>
            <orderedlist>
              <listitem>
                <para>
                  Install the latest Red Hat Enterprise Linux relase. The instructions where tested with Red Hat Enterprise Linux release 8.6 (Ootpa), 
                  but should work on other versions as well.
                </para>
              </listitem>
              <listitem>
                <para>
                  Setup the needed Atomia repository which contains required rpms.
                </para>
              </listitem>
              <listitem>
                <para>
                  Enable codeready builder for RHEL.
                </para>
                <informalexample>
                  <programlisting>subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Install MySQL server</para>
                <informalexample>
                  <programlisting>yum install mysql-server</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Install PowerDNS and PowerDNS MySQL backend</para>
                <informalexample>
                  <programlisting>curl -O https://dl.fedoraproject.org/pub/epel/8/Everything/x86_64/Packages/e/epel-release-8-15.el8.noarch.rpm
yum localinstall epel-release-8-15.el8.noarch.rpm
yum install pdns
yum install pdns-backend-mysql</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Install AtomiaDNS PowerDNSSync and setup config</para>
                <informalexample>
                  <programlisting>yum install atomiadns-powerdnssync
echo "servername = `hostname`" >> /etc/atomiadns.conf
echo 'soap_uri=http://INSERT_IP_OF_API_SERVER/atomiadns' >> /etc/atomiadns.conf
echo 'soap_username=YOUR_OPTIONAL_BUT_OBVIOUSLY_HIGHLY_RECOMMENDED_API_SERVER_USERNAME' >> /etc/atomiadns.conf
echo 'soap_password=YOUR_OPTIONAL_BUT_OBVIOUSLY_HIGHLY_RECOMMENDED_API_SERVER_PASSWORD' >> /etc/atomiadns.conf</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Start the services</para>
                <informalexample>
                  <programlisting>service mysqld start
service atomiadns-powerdnssync start</programlisting>
                </informalexample>
              </listitem>
              <listitem>
                <para>Initialize the database</para>
                <informalexample>
                  <programlisting>mysql -u root
  create schema powerdns;
  CREATE USER 'powerdns'@'localhost' IDENTIFIED BY 'atomiadns123';
  GRANT ALL PRIVILEGES ON powerdns.* TO 'powerdns'@'localhost';
  \q

wget https://raw.githubusercontent.com/atomia/atomiadns/develop/powerdns_sync/schema/powerdns.sql
mysql -u root powerdns &lt; powerdns.sql</programlisting>
                </informalexample>
              </listitem>
            </orderedlist>
        </section>
        <section xml:id="usage-powerdns-installation-software">
          <title>Software used by Atomia DNS PowerDNS Nameserver</title>
          <para>On the nameservers the following software is needed:</para>
          <itemizedlist>
            <listitem>
              <para>PowerDNS</para>
            </listitem>
            <listitem>
              <para>MySQL</para>
            </listitem>
            <listitem>
              <para>Atomia DNS PowerDNS sync</para>
            </listitem>
          </itemizedlist>
        </section>
      </section>
    </section>
    <section xml:id="usage-dyndns">
      <title>Atomia DNS DynDNS</title>
      <section xml:id="usage-dyndns-whatis">
        <title>What is the Atomia DNS DynDNS server?</title>
        <para>Atomia DNS DynDNS provides a DynDNS server supporting standard DNS update requests, performing the updates using an Atomia DNS Master server installation.</para>
        <para>When using Atomia DNS DynDNS any standard DynDNS client can be used. Examples include:</para>
        <orderedlist>
          <listitem>
            <para>nsupdate</para>
          </listitem>
          <listitem>
            <para>dhcpd</para>
          </listitem>
          <listitem>
            <para>Windows DHCP client service</para>
          </listitem>
        </orderedlist>
      </section>
      <section xml:id="usage-dyndns-docs">
        <title>Atomia DNS DynDNS server documentation</title>
        <para>Please locate the desired information in one of the following sections:</para>
        <itemizedlist>
          <listitem>
            <para>
              <link linkend="usage-dyndns-docs-configuration">Atomia DNS DynDNS configuration</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-dyndns-docs-installation">Atomia DNS DynDNS installation</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-dyndns-docs-techinfo">Atomia DNS DynDNS technical information</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-dyndns-docs-updates">Atomia DNS DynDNS updates</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link linkend="usage-dyndns-docs-usage">Atomia DNS DynDNS usage</link>
            </para>
          </listitem>
        </itemizedlist>
      </section>
      <section xml:id="usage-dyndns-docs-configuration">
        <title>Atomia DNS DynDNS configuration</title>
        <para>You have to configure the Atomia DNS DynDNS server to fit your environment.</para>
        <section xml:id="usage-dyndns-docs-configuration-file">
          <title>Configuration file</title>
          <para>
            The config file used by Atomia DNS DynDNS is placed in
            <code>/etc/atomiadns.conf</code>
            and contains the following settings:
          </para>
          <informaltable>
            <colgroup />
            <thead>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>Parameter</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Example</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>Description</para>
                </td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>soap_uri</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>
                    <link xlink:href="http://hostname.of.your.soap.server/atomiadns">http://hostname.of.your.soap.server/atomiadns</link>
                  </para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>URI of the Atomia DNS API.</para>
                </td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>tsig_keyname</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>atomia-dns-key</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>The name of the shared key that all authorized DDNS clients needs to use.</para>
                </td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">
                  <para>tsig_key</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>ZXhhbXBsZQ==</para>
                </td>
                <td rowspan="1" colspan="1">
                  <para>The base64-encoded shared key used to authorize DDNS updates.</para>
                </td>
              </tr>
            </tbody>
          </informaltable>
          <para>
            soap_uri and tsig_key always needs to be changed. For the other parameter, the default settings will work if used at
            <?linebreak?>
            the clients as well.
          </para>
          <para>Default config file:</para>
          <informalexample>
            <programlisting>soap_uri = http://your.atomia.dns.master.server.com/atomiadns
tsig_keyname = atomia-dns-key
#tsig_key = ZXhhbXBsZQ==
            </programlisting>
          </informalexample>
        </section>
        <section xml:id="usage-dyndns-docs-scripts">
          <title>Scripts and commands</title>
          <para>
            For more information on how to use the Atomia DNS DynDNS server see
            <link linkend="usage-dyndns-docs-usage">Atomia DNS DynDNS usage</link>
            .
          </para>
        </section>
      </section>
      <section xml:id="usage-dyndns-docs-installation">
        <title>Atomia DNS DynDNS installation</title>
        <section xml:id="usage-dyndns-docs-installation-server">
          <title>Installing Atomia DNS DynDNS server</title>
          <orderedlist>
            <listitem>
              <para>
                  Do a standard installation of Ubuntu 10.04 LTS.
              </para>
            </listitem>
            <listitem>
              <para>
                  	Add the Atomia APT Repository to the server using:
	                <programlisting>wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</programlisting>
              </para>
            </listitem>
            <listitem>
              <para>Update all packages:</para>
              <informalexample>
                <programlisting>apt-get update</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Install the Atomia DNS DynDNS server:</para>
              <informalexample>
                <programlisting>apt-get install atomia-dyndns</programlisting>
              </informalexample>
            </listitem>
            <listitem>
              <para>Edit the configuration file:</para>
              <informalexample>
                <programlisting>edit /etc/atomiadns.conf</programlisting>
              </informalexample>
              <orderedlist>
                <listitem>
                  <para>Change the soap_uri row to contain the hostname of your Atomia DNS Master server</para>
                </listitem>
                <listitem>
                  <para>Add a row looking like 'tsig_key = SomeBase64_encoded_value '</para>
                </listitem>
                <listitem>
                  <para>Example configuration:</para>
                  <informalexample>
                    <programlisting>soap_uri = http://your.atomia.dns.master.server.com/atomiadns
tsig_keyname = atomia-dns-key
tsig_key = kT6ulFA6Dg0qyRZv9vRrkA==
ver
                    </programlisting>
                  </informalexample>
                </listitem>
              </orderedlist>
            </listitem>
            <listitem>
              <para>Start the DynDNS server:</para>
              <informalexample>
                <programlisting>/etc/init.d/atomia-dyndns start</programlisting>
              </informalexample>
            </listitem>
          </orderedlist>
        </section>
        <section xml:id="usage-dyndns-docs-installation-server-software">
          <title>Software used by Atomia DNS DynDNS</title>
          <para>On the DynDNS server the following software is needed:</para>
          <itemizedlist>
            <listitem>
              <para>
                <emphasis role="italics">Config::General</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">SOAP::Lite</emphasis>
              </para>
            </listitem>
            <listitem>
              <para>
                <emphasis role="italics">Net::DNS</emphasis>
              </para>
            </listitem>
          </itemizedlist>
          <para>
            All needed software, including prerequisites are installed by the provided package,
            <emphasis role="italics">atomia-dyndns</emphasis>
            .
          </para>
        </section>
      </section>
      <section xml:id="usage-dyndns-docs-techinfo">
        <title>Architecture</title>
        <para>
          Atomia DNS DynDNS accepts DNS update requests on port 5353, authenticates them using a key shared
          <?linebreak?>
          with authorized clients and then connects to the Atomia DNS Master server to perform the needed
          <?linebreak?>
          prerequisite checks and/or updates.
        </para>
      </section>
      <section xml:id="usage-dyndns-docs-updates">
        <title>Atomia DNS DynDNS updates</title>
        <para>To install an update, complete the following steps:</para>
        <orderedlist>
          <listitem>
            <para>Update all packages:</para>
            <informalexample>
              <programlisting>apt-get update</programlisting>
            </informalexample>
          </listitem>
          <listitem>
            <para>Note the version number of the package currently installed.</para>
          </listitem>
          <listitem>
            <para>Install updates using:</para>
            <informalexample>
              <programlisting>apt-get install atomia-dyndns
/etc/init.d/atomia-dyndns restart
              </programlisting>
            </informalexample>
          </listitem>
        </orderedlist>
        <para>If you for some reason want to rollback to the previous version, then run:</para>
        <informalexample>
          <programlisting>apt-get install atomia-dyndns=version-number-noted</programlisting>
        </informalexample>
        <para>Any changes in the dependencies will be handled appropriately by the installation package, upgrading or installing them as needed.</para>
        <section xml:id="usage-dyndns-docs-updates-where">
          <title>Where to get updates?</title>
          <para>
              Updates are distributed using the Atomia APT repository.
		If not done, then add the Atomia APT Repository to the server using:
		<programlisting>wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</programlisting>
          </para>
        </section>
      </section>
      <section xml:id="usage-dyndns-docs-usage">
        <title>Client applications</title>
        <para>
          The Atomia DNS DynDNS application only comes with the DDNS server. To update zones using the server all
          <?linebreak?>
          standard DDNS clients, like nsupdate, can be used.
        </para>
        <para>
          The server listens on port 5353 to distinguish it from authorative nameservers (it only handles the UPDATE
          <?linebreak?>
          opcode, not other queries against the handled zones).
        </para>
        <para>Example using nsupdate (which is included with Bind):</para>
        <informalexample>
          <programlisting>cat &lt;&lt;EOF | nsupdate
server your.dyndns.server 5353
zone some.zone.com
key atomia-dns-key ZXhhbXBsZQ==
prereq yxrrset somehost.some.zone.com A
update delete somehost.some.zone.com A
update add somehost.some.zone.com 300 A 127.0.0.1
send
EOF
          </programlisting>
        </informalexample>
      </section>
    </section>
  </section>
  <section xml:id="faq">
    <title>FAQ</title>
    <itemizedlist>
      <listitem>
        <para>
          <link linkend="faq-hardware">What hardware is required for the Atomia DNS system?</link>
        </para>
      </listitem>
      <listitem>
        <para>
          <link linkend="faq-software">What software is required for the Atomia DNS system?</link>
        </para>
      </listitem>
      <listitem>
        <para>
          <link linkend="faq-qps">How many queries can Atomia DNS handle?</link>
        </para>
      </listitem>
      <listitem>
        <para>
          <link linkend="faq-scaling">How well does Atomia DNS scale?</link>
        </para>
      </listitem>
      <listitem>
        <para>
          <link linkend="faq-howto-admin">How do I administrate zones in Atomia DNS?</link>
        </para>
      </listitem>
      <listitem>
        <para>
          <link linkend="faq-corrupted-bdb">The database on my Atomia DNS Bind-DLZ Nameserver has been corrupted. How do I fix it?</link>
        </para>
      </listitem>
    </itemizedlist>
    <section xml:id="faq-hardware">
      <title>What hardware is required for the Atomia DNS system?</title>
      <para>
        The absolute minimum requirement is one machine, but this would require the
        <link linkend="usage-master-server">Atomia DNS Master server</link>
        and
        <link linkend="usage-bind-dlz">Atomia DNS Bind-DLZ Nameserver</link>
        to be installed on the same machine which is not recommended.
      </para>
      <para>A more likely scenario would be:</para>
      <orderedlist>
        <listitem>
          <para>Server running Atomia DNS Master.</para>
        </listitem>
        <listitem>
          <para>Backup replica of the Atomia DNS Master database.</para>
        </listitem>
        <listitem>
          <para>Two or more servers running Atomia DNS Bind-DLZ Nameserver.</para>
        </listitem>
      </orderedlist>
      <para>For larger installations it is also possible to install Atomia DNS API and Atomia DNS database on separate machines.</para>
    </section>
    <section xml:id="faq-software">
      <title>What software is required for the Atomia DNS system?</title>
      <para>
        The software requirements for the Atomia DNS Master are listed in the
        <link linkend="usage-master-installation">Atomia DNS Master server installation</link>
        instructions and the software requirements for Atomia DNS Bind-DLZ Nameserver are listed in the
        <link linkend="usage-bind-dlz-installation">Atomia DNS Bind-DLZ Nameserver installation</link>
        instructions.
      </para>
    </section>
    <section xml:id="faq-qps">
      <title>How many queries can Atomia DNS handle?</title>
      <para>
        The Atomia DNS Bind-DLZ Nameserver has been tested using dnsperf (
        <link xlink:href="http://www.nominum.com/services/measurement_tools.php">http://www.nominum.com/services/measurement_tools.php</link>
        ) on a modest system to see its performance.
      </para>
      <para>With dnsperf running on the same machine as the nameserver, this modest system managed to handle 8609 queries per second.</para>
    </section>
    <section xml:id="faq-scaling">
      <title>How well does Atomia DNS scale?</title>
      <para>Atomia DNS can scale to handle large DNS infrastructures both on the back end and in terms of nameservers. To be able to scale and handle many DNS queries you only need to add more nameservers into the system. The load will then be spread across all nameservers.</para>
      <para>The Atomia DNS Master doesn't usually have a high load since it is only used to provision changes to the nameservers. To scale the Atomia DNS Master server, the Atomia DNS API and Atomia DNS Database can be installed on separate servers. For higher requirements it is also possible to load balance the API using several servers.</para>
    </section>
    <section xml:id="faq-howto-admin">
      <title>How do I administrate zones in Atomia DNS?</title>
      <para>
        Atomia DNS comes with an
        <link linkend="apidocs">API</link>
        containing functions for administrating DNS settings.
      </para>
    </section>
    <section xml:id="faq-corrupted-bdb">
      <title>The database on my Atomia DNS Bind-DLZ Nameserver has been corrupted. How do I fix it?</title>
      <para>
        The recommended way is to do a full resync using Atomia DNS Sync. More information about this can be found in the
        <link linkend="usage-bind-dlz-usage-syncer-man">Atomia DNS Sync manual</link>
        .
      </para>
    </section>
  </section>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="../server/docbook_api_documentation/apidocs.xml" />
</article>

